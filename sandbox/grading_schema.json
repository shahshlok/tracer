{
  "type": "object",
  "properties": {
    "scores": {
      "type": "object",
      "properties": {
        "total_points_awarded": { "type": "number" },
        "max_points": { "type": "number" },
        "percentage": { "type": "number" }
      },
      "required": ["total_points_awarded", "max_points", "percentage"],
      "additionalProperties": false
    },
    "category_scores": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "task": { "type": "string" },
          "points_awarded": { "type": "number" },
          "max_points": { "type": "number" },
          "reasoning": { "type": "string" },
          "confidence": { "type": "number" },
          "reasoning_tokens": { "type": "integer" }
        },
        "required": ["category_id", "task", "points_awarded", "max_points", "reasoning", "confidence", "reasoning_tokens"],
        "additionalProperties": false
      }
    },
    "feedback": {
      "type": "object",
      "properties": {
        "overall_comment": { "type": "string" },
        "strengths": { "type": "array", "items": { "type": "string" } },
        "areas_for_improvement": { "type": "array", "items": { "type": "string" } }
      },
      "required": ["overall_comment", "strengths", "areas_for_improvement"],
      "additionalProperties": false
    },
    "misconceptions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "confidence": { "type": "number" },
          "evidence": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "source": { "type": "string" },
                "file_path": { "type": "string" },
                "language": { "type": "string" },
                "snippet": { "type": "string" },
                "line_start": { "type": "integer" },
                "line_end": { "type": "integer" },
                "note": { "type": "string" }
              },
              "required": ["source", "file_path", "language", "snippet", "line_start", "line_end", "note"],
              "additionalProperties": false
            }
          },
          "validated_by": { "type": ["string", "null"] }
        },
        "required": ["name", "description", "confidence", "evidence"],
        "additionalProperties": false
      }
    }
  },
  "required": ["scores", "category_scores", "feedback", "misconceptions"],
  "additionalProperties": false
}
